(function(t){function e(e){for(var n,o,i=e[0],c=e[1],m=e[2],u=0,l=[];u<i.length;u++)o=i[u],a[o]&&l.push(a[o][0]),a[o]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);p&&p(e);while(l.length)l.shift()();return r.push.apply(r,m||[]),s()}function s(){for(var t,e=0;e<r.length;e++){for(var s=r[e],n=!0,o=1;o<s.length;o++){var i=s[o];0!==a[i]&&(n=!1)}n&&(r.splice(e--,1),t=c(c.s=s[0]))}return t}var n={},o={app:0},a={app:0},r=[];function i(t){return c.p+"js/"+({about:"about"}[t]||t)+"."+{about:"dba27a30"}[t]+".js"}function c(e){if(n[e])return n[e].exports;var s=n[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,c),s.l=!0,s.exports}c.e=function(t){var e=[],s={about:1};o[t]?e.push(o[t]):0!==o[t]&&s[t]&&e.push(o[t]=new Promise(function(e,s){for(var n="css/"+({about:"about"}[t]||t)+"."+{about:"1374ab2c"}[t]+".css",a=c.p+n,r=document.getElementsByTagName("link"),i=0;i<r.length;i++){var m=r[i],u=m.getAttribute("data-href")||m.getAttribute("href");if("stylesheet"===m.rel&&(u===n||u===a))return e()}var l=document.getElementsByTagName("style");for(i=0;i<l.length;i++){m=l[i],u=m.getAttribute("data-href");if(u===n||u===a)return e()}var p=document.createElement("link");p.rel="stylesheet",p.type="text/css",p.onload=e,p.onerror=function(e){var n=e&&e.target&&e.target.src||a,r=new Error("Loading CSS chunk "+t+" failed.\n("+n+")");r.code="CSS_CHUNK_LOAD_FAILED",r.request=n,delete o[t],p.parentNode.removeChild(p),s(r)},p.href=a;var d=document.getElementsByTagName("head")[0];d.appendChild(p)}).then(function(){o[t]=0}));var n=a[t];if(0!==n)if(n)e.push(n[2]);else{var r=new Promise(function(e,s){n=a[t]=[e,s]});e.push(n[2]=r);var m,u=document.createElement("script");u.charset="utf-8",u.timeout=120,c.nc&&u.setAttribute("nonce",c.nc),u.src=i(t),m=function(e){u.onerror=u.onload=null,clearTimeout(l);var s=a[t];if(0!==s){if(s){var n=e&&("load"===e.type?"missing":e.type),o=e&&e.target&&e.target.src,r=new Error("Loading chunk "+t+" failed.\n("+n+": "+o+")");r.type=n,r.request=o,s[1](r)}a[t]=void 0}};var l=setTimeout(function(){m({type:"timeout",target:u})},12e4);u.onerror=u.onload=m,document.head.appendChild(u)}return Promise.all(e)},c.m=t,c.c=n,c.d=function(t,e,s){c.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},c.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},c.t=function(t,e){if(1&e&&(t=c(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(c.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)c.d(s,n,function(e){return t[e]}.bind(null,n));return s},c.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return c.d(e,"a",e),e},c.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},c.p="/public/",c.oe=function(t){throw console.error(t),t};var m=window["webpackJsonp"]=window["webpackJsonp"]||[],u=m.push.bind(m);m.push=e,m=m.slice();for(var l=0;l<m.length;l++)e(m[l]);var p=u;r.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("56d7")},"034f":function(t,e,s){"use strict";var n=s("64a9"),o=s.n(n);o.a},"56d7":function(t,e,s){"use strict";s.r(e);s("7f7f"),s("cadf"),s("551c"),s("f751"),s("097d");var n=s("2b0e"),o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticStyle:{},attrs:{id:"app"}},[s("router-view")],1)},a=[],r={name:"app",data:function(){return{}}},i=r,c=(s("034f"),s("2877")),m=Object(c["a"])(i,o,a,!1,null,null,null),u=m.exports,l=s("8c4f"),p=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"index"},[s("van-nav-bar",{attrs:{title:"在线好友("+(this.chatUserList.length-1)+")"}},[s("div",{staticStyle:{height:"46px","line-height":"46px"},attrs:{slot:"right"},slot:"right"},[s("i",{staticStyle:{color:"rgb(30, 228, 32)"}},[t._v("•")]),t._v(" 在线\n    ")])]),s("van-cell-group",t._l(this.chatUserList,function(e){return e.name!=t.name?s("van-cell",{attrs:{value:"12:00",to:{name:"message",params:{to_name:e.name}}}},[s("template",{slot:"icon"},[s("van-icon",{staticClass:"custom-icon",attrs:{size:"60px",name:"http://juntao.oss-cn-shenzhen.aliyuncs.com/images/wechat/avatar/xX9hSG0utRz0hmC4hA5b4nWL46Jgn8YGhQ7psWyU.png"}})],1),s("template",{slot:"title"},[s("div",{staticStyle:{"padding-left":"10px"}},[s("span",{staticClass:"custom-text"},[t._v(t._s(e.name))]),s("p",{staticStyle:{margin:"5px 0",color:"rgb(152, 152, 152)"}},[t._v(t._s(t.name))])])])],2):t._e()}),1),s("van-button",{attrs:{type:"default"},on:{click:t.debug}},[t._v("默认按钮")]),s("van-tabbar",{staticStyle:{height:"55px"},attrs:{route:""},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},[s("van-tabbar-item",{attrs:{replace:"",to:"/",info:"10",icon:"chat"}},[t._v("消息")]),s("van-tabbar-item",{attrs:{replace:"",to:"/about",icon:"manager"}},[t._v("个人")])],1)],1)},d=[],h=s("cebc"),g=s("2f62"),f={name:"index",data:function(){return{active:0,list:[],name:""}},created:function(){this.name=this.$store.getters.user},methods:{debug:function(){console.log(this.$store.getters.getRecord)}},computed:Object(h["a"])({},Object(g["b"])(["chatUserList"])),components:{}},v=f,b=Object(c["a"])(v,p,d,!1,null,null,null),w=b.exports,x=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"Message"},[s("van-nav-bar",{attrs:{"left-text":"返回",title:this.$route.params.to_name,"left-arrow":""},on:{"click-left":t.onClickLeft}}),s("div",{staticStyle:{"padding-bottom":"300px"}},t._l(t.records,function(e){return s("div",{staticStyle:{"margin-top":"15px"}},[s("div",{style:e.is_me?"padding:0 15px 0 0;float:right":"padding:0 0 0 15px;float:left"},[s("van-icon",{attrs:{size:"40px",name:"http://juntao.oss-cn-shenzhen.aliyuncs.com/images/wechat/avatar/xX9hSG0utRz0hmC4hA5b4nWL46Jgn8YGhQ7psWyU.png"}})],1),s("div",{staticClass:"msg-content"},[s("div",{class:e.is_me?"right-msg":"left-msg",staticStyle:{"word-wrap":"break-word"}},[t._v("\n          "+t._s(1==e.type?e.content:"")+"\n          "),2==e.type?s("img",{attrs:{src:e.content}}):t._e()])])])}),0),s("div",{staticClass:"send"},[s("van-row",[s("van-col",{staticClass:"controller",attrs:{span:"24"}},[s("div",{staticClass:"one"},[s("van-icon",{staticClass:"my-icon",attrs:{size:"20px",name:"volume",color:"#737373"}})],1),s("div",{staticClass:"two"},[s("van-field",{attrs:{placeholder:"请输入"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.send(e)}},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})],1),s("div",{staticClass:"three"},[s("van-icon",{staticClass:"my-icon",attrs:{size:"20px",name:"smile-o",color:"#737373"},on:{click:function(e){return t.showBottom("emoji")}}}),s("van-icon",{staticClass:"my-icon",attrs:{size:"20px",name:"add",color:"#737373"},on:{click:function(e){return t.showBottom("pic")}}})],1)])],1),"emoji"==t.active?s("van-row",[s("van-col",{staticClass:"smile-content",staticStyle:{"background-color":"#f8f8f8"},attrs:{span:"24"}},[s("img",{staticClass:"smile-icon",attrs:{src:"https://raw.githubusercontent.com/tmm1/emoji-extractor/master/images/160x160/1.png",alt:""},on:{click:t.sendEmoji}}),s("img",{staticClass:"smile-icon",attrs:{src:"https://raw.githubusercontent.com/tmm1/emoji-extractor/master/images/160x160/198.png",alt:""},on:{click:t.sendEmoji}}),s("img",{staticClass:"smile-icon",attrs:{src:"https://raw.githubusercontent.com/tmm1/emoji-extractor/master/images/160x160/201.png",alt:""},on:{click:t.sendEmoji}}),s("img",{staticClass:"smile-icon",attrs:{src:"https://raw.githubusercontent.com/tmm1/emoji-extractor/master/images/160x160/202.png",alt:""},on:{click:t.sendEmoji}}),s("img",{staticClass:"smile-icon",attrs:{src:"https://raw.githubusercontent.com/tmm1/emoji-extractor/master/images/160x160/429.png",alt:""},on:{click:t.sendEmoji}}),s("img",{staticClass:"smile-icon",attrs:{src:"https://raw.githubusercontent.com/tmm1/emoji-extractor/master/images/160x160/430.png",alt:""},on:{click:t.sendEmoji}}),s("img",{staticClass:"smile-icon",attrs:{src:"https://raw.githubusercontent.com/tmm1/emoji-extractor/master/images/160x160/431.png",alt:""},on:{click:t.sendEmoji}}),s("img",{staticClass:"smile-icon",attrs:{src:"https://raw.githubusercontent.com/tmm1/emoji-extractor/master/images/160x160/432.png",alt:""},on:{click:t.sendEmoji}}),s("img",{staticClass:"smile-icon",attrs:{src:"https://raw.githubusercontent.com/tmm1/emoji-extractor/master/images/160x160/434.png",alt:""},on:{click:t.sendEmoji}}),s("img",{staticClass:"smile-icon",attrs:{src:"https://raw.githubusercontent.com/tmm1/emoji-extractor/master/images/160x160/438.png",alt:""},on:{click:t.sendEmoji}}),s("img",{staticClass:"smile-icon",attrs:{src:"https://raw.githubusercontent.com/tmm1/emoji-extractor/master/images/160x160/460.png",alt:""},on:{click:t.sendEmoji}}),s("img",{staticClass:"smile-icon",attrs:{src:"https://raw.githubusercontent.com/tmm1/emoji-extractor/master/images/160x160/701.png",alt:""},on:{click:t.sendEmoji}}),s("img",{staticClass:"smile-icon",attrs:{src:"https://raw.githubusercontent.com/tmm1/emoji-extractor/master/images/160x160/705.png",alt:""},on:{click:t.sendEmoji}}),s("img",{staticClass:"smile-icon",attrs:{src:"https://raw.githubusercontent.com/tmm1/emoji-extractor/master/images/160x160/703.png",alt:""},on:{click:t.sendEmoji}}),s("img",{staticClass:"smile-icon",attrs:{src:"https://raw.githubusercontent.com/tmm1/emoji-extractor/master/images/160x160/706.png",alt:""},on:{click:t.sendEmoji}}),s("img",{staticClass:"smile-icon",attrs:{src:"https://raw.githubusercontent.com/tmm1/emoji-extractor/master/images/160x160/719.png",alt:""},on:{click:t.sendEmoji}}),s("img",{staticClass:"smile-icon",attrs:{src:"https://raw.githubusercontent.com/tmm1/emoji-extractor/master/images/160x160/720.png",alt:""},on:{click:t.sendEmoji}}),s("img",{staticClass:"smile-icon",attrs:{src:"https://raw.githubusercontent.com/tmm1/emoji-extractor/master/images/160x160/725.png",alt:""},on:{click:t.sendEmoji}}),s("img",{staticClass:"smile-icon",attrs:{src:"https://raw.githubusercontent.com/tmm1/emoji-extractor/master/images/160x160/728.png",alt:""},on:{click:t.sendEmoji}}),s("img",{staticClass:"smile-icon",attrs:{src:"https://raw.githubusercontent.com/tmm1/emoji-extractor/master/images/160x160/741.png",alt:""},on:{click:t.sendEmoji}})])],1):t._e(),"pic"==t.active?s("van-row",[s("van-col",{staticStyle:{"background-color":"#f8f8f8"},attrs:{span:"24"}},[s("van-uploader",{staticStyle:{margin:"20px 15px"},attrs:{"after-read":t.onRead}},[s("van-icon",{staticClass:"send-pic",attrs:{size:"45px",name:"photo",color:"#737373"}}),s("div",{staticStyle:{"text-align":"center","font-size":"14px"}},[t._v("上传图片")])],1)],1)],1):t._e()],1)],1)},E=[],S={name:"Message",data:function(){return{active:"",emoji:"http://juntao.oss-cn-shenzhen.aliyuncs.com/images/video/courses/packages/f2HQCKV4GMcG4Ajfu0z4eXHEJQ5vOdW6S3Mcc4oo.jpeg",value:"",records:{}}},components:{},created:function(){this.records=this.$store.getters.getRecordBy(this.$route.params.to_name)},methods:{onClickLeft:function(){this.$router.push({name:"index",params:{}})},showBottom:function(t){this.active!=t?this.active=t:this.active=""},send:function(){var t={Source:1,From:this.user,To:this.$route.params.to_name,Type:1,Content:this.value,SendAt:"2015"},e={from:this.$route.params.to_name,type:1,is_me:!0,content:this.value};this.$store.dispatch("giveMe",e),this.ws.send(JSON.stringify(t)),this.value=""},onRead:function(t){console.log(t)},sendEmoji:function(t){console.log(t.currentTarget.src);var e={Source:1,From:this.user,To:this.$route.params.to_name,Type:2,Content:t.currentTarget.src,SendAt:"2015"},s={from:this.$route.params.to_name,type:2,is_me:!0,content:t.currentTarget.src};this.$store.dispatch("giveMe",s),this.ws.send(JSON.stringify(e))}},computed:Object(h["a"])({},Object(g["b"])(["ws","user"]))},k=S,y=(s("bd5c"),Object(c["a"])(k,x,E,!1,null,null,null)),j=y.exports,_=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"loign"},[s("van-cell-group",[s("van-field",{attrs:{required:"",clearable:"",label:"用户名","right-icon":"question-o",placeholder:"请输入用户名"},model:{value:t.username,callback:function(e){t.username=e},expression:"username"}}),s("van-field",{attrs:{type:"password",label:"密码",placeholder:"请输入密码",required:""},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}})],1),s("van-button",{staticClass:"login-btn",attrs:{type:"default",size:"large"},on:{click:t.login}},[t._v("提交")])],1)},C=[],T={name:"login",data:function(){return{username:"",password:""}},methods:{login:function(){this.$store.dispatch("InitWebSocket",{username:this.username,password:this.password}),this.ws.onopen=this.websocketOnOpen,this.ws.onmessage=this.websocketOnMessage,this.ws.onclose=this.websocketClose,this.ws.onerror=this.websocketError,1==this.$store.getters.isLogin&&this.$router.push({name:"index",params:{}})},websocketOnOpen:function(){var t={Source:4,From:this.user,To:"",Type:0,SendAt:""};this.$store.getters.ws.send(JSON.stringify(t)),this.reset()},reset:function(){clearTimeout(this.$store.getters.timeoutObj),this.start()},start:function(){var t=this,e=setTimeout(function(){var e={type:"ping"};t.send(JSON.stringify(e))},this.timeout);this.$store.dispatch("SetTimeout",e)},websocketOnMessage:function(t){var e=JSON.parse(t.data);console.log(t.data),this.msgHandle(e),this.reset()},websocketClose:function(t){console.log("connection closed ("+t.code+")"),!1===this.state.websocket.login&&this.reconnect(this.state.websocket.url)},send:function(t){this.ws.send(t)},websocketError:function(t){this.reconnect(this.state.websocket.url)},reconnect:function(){var t=this;if(!this.state.websocket.lockReconnect){this.state.websocket.lockReconnect=!0;var e=this;setTimeout(function(){t.initWebSocket(e.user,e.state.websocket.password),t.state.websocket.lockReconnect=!1},2e3)}},msgHandle:function(t){switch(t.Source){case 1:this.giveMe(t);break;case 2:break;case 3:break;case 4:this.getUserList(t);break;case 5:this.addUser(t);break;case 6:this.removeUser(t);break}},getUserList:function(t){var e=JSON.parse(t.Content);this.$store.dispatch("setList",e)},giveMe:function(t){var e={from:t.From,type:t.Type,is_me:!1,content:t.Content};console.log(e),this.$store.dispatch("giveMe",e)},addUser:function(t){var e={name:t.Content};this.$store.dispatch("addUser",e),console.log(e),this.$store.dispatch("addRecord",t.Content)},removeUser:function(t){this.$store.dispatch("removeUser",t.Content)}},computed:Object(h["a"])({},Object(g["b"])(["ws","user"])),components:{}},O=T,R=(s("d6db"),Object(c["a"])(O,_,C,!1,null,null,null)),L=R.exports;n["a"].use(l["a"]);var $=new l["a"]({routes:[{path:"/",name:"index",component:w},{path:"/message",name:"message",component:j},{path:"/login",name:"login",component:L},{path:"/about",name:"about",component:function(){return s.e("about").then(s.bind(null,"f820"))}}]}),U=s("4592"),A={state:{ws:"",name:"",pwd:"",url:"ws://"+location.host+"/ws",timeoutObj:"",login:!1,lockReconnect:!1},mutations:{SET_WS:function(t,e){t.ws=e},SET_NAME:function(t,e){t.name=e},SET_PWD:function(t,e){t.pwd=e},SET_TIMEOUTOBJ:function(t,e){t.timeoutObj=e},SET_LOGIN:function(t,e){t.login=e}},getters:{isLogin:function(t){return t.login},ws:function(t){return t.ws},timeoutObj:function(t){return t.timeoutObj},user:function(t){return t.name}},actions:{InitWebSocket:function(t,e){var s=t.commit,n=t.state;s("SET_NAME",e.username),s("SET_PWD",e.password),s("SET_LOGIN",!0);var o=new WebSocket(n.url+"?name="+e.username+"&password="+e.password);s("SET_WS",o)},SendMsg:function(t){this.state.websocket.ws.send(t)},SetTimeout:function(t,e){var s=t.commit;s("SET_TIMEOUTOBJ",e)}}},M=A,N=(s("ac4d"),s("8a81"),s("ac6a"),{state:{username:"",avatar:"",userList:[],record:{}},mutations:{SET_USERNAME:function(t,e){t.username=e},SET_AVATAR:function(t,e){t.avatar=e},SET_USERLIST:function(t,e){t.userList=e;var s=!0,n=!1,o=void 0;try{for(var a,r=e[Symbol.iterator]();!(s=(a=r.next()).done);s=!0){var i=a.value;t.record[i.name]=[]}}catch(c){n=!0,o=c}finally{try{s||null==r.return||r.return()}finally{if(n)throw o}}},SET_ADDUSER:function(t,e){t.userList.push(e)},SET_RENOVEUSER:function(t,e){var s=0;for(var n in t.userList)if(t.userList[n].name==e){s=n;break}t.userList.splice(s,1)},SET_RECOR:function(t,e){t.record[e]=[]},SET_ADDRECOR:function(t,e){t.record[e.from].push(e)}},getters:{name:function(t){return t.username},chatUserList:function(t){return t.userList},getRecordBy:function(t){return function(e){return t.record[e]}},getRecord:function(t){return t.record}},actions:{setList:function(t,e){var s=t.commit;s("SET_USERLIST",e)},removeUser:function(t,e){var s=t.commit;s("SET_RENOVEUSER",e)},giveMe:function(t,e){var s=t.commit;console.log(4545444545445454),console.log(e),s("SET_ADDRECOR",e)},addUser:function(t,e){var s=t.commit;s("SET_ADDUSER",e)},addRecord:function(t,e){var s=t.commit;s("SET_RECOR",e)}}}),z=N;n["a"].use(g["a"]);var J=new g["a"].Store({modules:{websocket:M,chat:z}}),W=J;s("7c88");n["a"].use(U["a"]),n["a"].config.productionTip=!1,$.beforeEach(function(t,e,s){W.getters.isLogin?("login"==t.name&&s({path:"/"}),s()):"login"==t.name?s():s({path:"/login"})}),new n["a"]({router:$,store:W,render:function(t){return t(u)}}).$mount("#app")},"64a9":function(t,e,s){},a9e7:function(t,e,s){},bd5c:function(t,e,s){"use strict";var n=s("dcc7"),o=s.n(n);o.a},d6db:function(t,e,s){"use strict";var n=s("a9e7"),o=s.n(n);o.a},dcc7:function(t,e,s){}});
//# sourceMappingURL=app.d0a73c81.js.map